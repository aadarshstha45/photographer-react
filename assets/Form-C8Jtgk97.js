import{p as C,l as J,r as i,j as a,q as O,F as W,T as V,H as K,B as y,t as R}from"./index-DyjPmHh2.js";import{R as A}from"./index-DKWtTl3u.js";import"./lodash-MsvIzqMc.js";import{S as Q}from"./index-ijY64M_a.js";import{u as X,T as P}from"./index-DGGATZOe.js";import{u as Y}from"./useGetDirtyData-Dc4_-Xhu.js";import{u as _}from"./useGetErrors-Bhs_yQR9.js";import{b as Z,c as $,d as w}from"./service-work-C7X5zgA-.js";import"./Plus-CCRCGmIE.js";import"./tslib.es6-KGZ4s6vb.js";import"./inputProps-DUnb2QB6.js";import"./Trash-CLOyVgN0.js";import"./visually-hidden.style-Bfr07Aua.js";import"./service-form-methods--yukZyD2.js";const le=()=>{var S;const m={name:"",description:"",image:"",is_active:"1",images:[]},{id:t}=C(),{mutateAsync:q,isPending:z,isError:u,error:g}=Z(),{mutateAsync:B,isPending:H,isError:l,error:x}=$(),c=J(),{control:r,handleSubmit:T,reset:o,formState:M}=X({defaultValues:m}),{data:e,isFetching:N}=w(parseInt(t)),[U,f]=i.useState([]),[h,k]=i.useState(!1),[b,G]=i.useState([]),[p,E]=i.useState({});i.useEffect(()=>{u?E(_(g)):l&&E(_(x))},[u,l,g,x]),i.useEffect(()=>{var n,s,d,v,j,D,F;t?(o({name:(n=e==null?void 0:e.data)==null?void 0:n.name,description:(s=e==null?void 0:e.data)==null?void 0:s.description,image:(d=e==null?void 0:e.data)==null?void 0:d.image,is_active:(v=e==null?void 0:e.data)!=null&&v.is_active?"1":"0"}),(((j=e==null?void 0:e.data)==null?void 0:j.images.length)??!1)&&f(((F=(D=e==null?void 0:e.data)==null?void 0:D.images)==null?void 0:F.map(I=>({id:I.id,url:I.image})))||[])):o(m)},[t,o,e==null?void 0:e.data]);const L=async n=>{const s=t?R(Y(M,n)):R(n);t?(b.length>0&&s.append("deleted_images",JSON.stringify(b)),h&&s.append("remove_image",h),(await B({id:t,data:s})).data.status&&(o(m),c("/work"))):(await q({data:s})).data.status&&(o(m),c("/work"))};return N?a.jsx(O,{height:"70dvh",width:"70dvw"}):a.jsxs(W,{flexDir:"column",gap:4,children:[a.jsxs(V,{fontWeight:600,fontSize:"2xl",children:[t?"Edit":"Add"," Work"]}),a.jsxs(W,{gap:4,flexDir:"column",as:"form",onSubmit:T(L),children:[a.jsx(P,{name:"name",control:r,label:"Name",backendError:p.name,isRequired:!0}),a.jsx(P,{control:r,name:"description",type:"textarea",label:"Description"}),a.jsx(A,{name:"image",control:r,label:"Image",options:{accept:{"image/*":[]}},boxWidth:"250px",boxHeight:"250px",file:t?(S=e==null?void 0:e.data)==null?void 0:S.image:"",isRequired:!0,noMaxSize:!0,backendError:p.image,setRemoveImage:k}),a.jsx(A,{isMultiple:!0,name:"images",control:r,label:"Images",options:{accept:{"image/*":[]}},noMaxSize:!0,prevFiles:U,setPrevFiles:f,setDeleteImages:G,width:"100%",boxWidth:"250px",boxHeight:"250px",isRequired:!0,backendError:p.images}),a.jsx(Q,{control:r}),a.jsxs(K,{spacing:2,my:6,children:[a.jsx(y,{variant:"outline",onClick:()=>c(-1),children:"Back"}),a.jsx(y,{type:"submit",isLoading:t?H:z,children:"Submit"})]})]})]})};export{le as default};
